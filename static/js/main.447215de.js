(()=>{"use strict";var e={5918:(e,n,t)=>{t.r(n),t.d(n,{default:()=>T});var l=t(296),i=t(6665),r=t(4701),o=t(4262),u=t(4890),a=t(6283),s=t(467),c=t(397),d=(0,i.createContext)();function f(e){var n=e.children,t=(0,i.useState)(null),r=(0,l.default)(t,2),o=r[0],u=r[1],a=(0,i.useState)(!0),s=(0,l.default)(a,2),f=s[0],h=s[1];return(0,i.useEffect)((function(){fetch("http://localhost:3000/api/auth/success",{credentials:"include"}).then((function(e){if(200===e.status)return e.json();throw new Error("Not authenticated")})).then((function(e){e.success?u(e.user):u(null)})).catch((function(){return u(null)})).finally((function(){return h(!1)}))}),[]),(0,c.jsx)(d.Provider,{value:{user:o,setUser:u,loading:f},children:n})}var h,p=t(2038),v={NODE_ENV:"production",PUBLIC_URL:"/pool-hall-waitlist",APP_MANIFEST:{name:"pool-hall-waitlist",slug:"pool-hall-waitlist",version:"1.0.0",sdkVersion:"50.0.0",platforms:["ios","android","web"],extra:{apiBaseUrl:"https://pool-hall-waitlist-3b8c64cbf25d.herokuapp.com",eas:{projectId:"aa45cd69-a930-432f-a3ab-77a197e338b6"}},updates:{url:"https://u.expo.dev/aa45cd69-a930-432f-a3ab-77a197e338b6"},runtimeVersion:{policy:"appVersion"},web:{}},EXPO_DEBUG:!1,PLATFORM:"web",WDS_SOCKET_PATH:"/_expo/ws"}.REACT_APP_API_BASE_URL||"http://localhost:3000";function m(){return h||(h=(0,p.io)(v,{autoConnect:!0})),h}function b(e,n){h||m(),h.emit(e,n)}var x=function(e,n,t,l,i){h.emit("confirm_win",{tableId:e,winnerId:n,loserId:t,confirmed:l},i)};const g=m();function j(e){var n,t,l=e.table,r=(0,i.useContext)(d).user,o=function(){var e,n;null!=r&&r._id&&null!=l&&l._id&&(e=l._id,n=r._id,console.log("[claimWin] Emitting claim_win",{tableId:e,winnerId:n}),b("claim_win",{tableId:e,winnerId:n}))},u=function(e){null!=l&&l._id&&e&&b("admin:remove_player",{tableId:l._id,userId:e})},a=null!=(n=null==l?void 0:l.players)?n:[];return(0,i.useEffect)((function(){null!=r&&r._id&&g.emit("register_user",{userId:r._id})}),[r]),(0,c.jsx)(c.Fragment,{children:(0,c.jsxs)("div",{style:{border:"1px solid #ccc",padding:10,marginBottom:10,borderRadius:5},children:[(0,c.jsxs)("h4",{children:["Table ",null!=(t=null==l?void 0:l.tableNumber)?t:"Unknown"]}),(0,c.jsx)("strong",{children:"Players:"}),(0,c.jsx)("ul",{children:a.map((function(e,n){var t,l=null==e?void 0:e.user,i=null!=(t=null==l?void 0:l._id)?t:n,a=(null==l?void 0:l.displayName)||(null==l?void 0:l.username)||"Unknown Player";return(0,c.jsxs)("li",{style:{marginBottom:6},children:[a,(null==r?void 0:r.isAdmin)&&(null==l?void 0:l._id)&&(0,c.jsx)("button",{onClick:function(){return u(l._id)},style:{marginLeft:10},children:"Remove Player"}),(null==r?void 0:r._id)===(null==l?void 0:l._id)&&(0,c.jsx)("button",{onClick:o,style:{marginLeft:10},children:"I WON"})]},i)}))}),a.length<2&&(0,c.jsx)("button",{onClick:function(){null!=r&&r._id&&null!=l&&l._id&&g.emit("join_table",{tableId:l._id,userId:r._id})},children:"Join Table"})]})})}function _(){var e=(0,i.useContext)(d),n=e.user,t=e.setUser,r=e.loading,o=(0,i.useState)([]),u=(0,l.default)(o,2),a=u[0],f=u[1],h=(0,i.useState)([]),p=(0,l.default)(h,2),v=p[0],m=p[1],_=(0,i.useState)(!1),y=(0,l.default)(_,2),w=y[0],I=y[1],C=(0,i.useState)(null),k=(0,l.default)(C,2),S=k[0],P=k[1],O=(0,i.useState)(30),T=(0,l.default)(O,2),A=T[0],E=T[1],L=(0,i.useRef)(null),U=(0,i.useState)(null),R=(0,l.default)(U,2),q=R[0],B=R[1],N=(0,i.useState)(!1),W=(0,l.default)(N,2),M=W[0],z=W[1];(0,i.useEffect)((function(){function e(e){var n=e.queue,t=e.tables;console.log("Received state_update with queue:",n,"tables:",t),f(n),m(t)}function n(e){P(e),I(!0),E(30),L.current&&clearInterval(L.current),L.current=setInterval((function(){E((function(e){return e<=1?(clearInterval(L.current),F(),0):e-1}))}),1e3)}function t(e){console.log("Received win confirmation request:",e),B(e)}return g.on("state_update",e),g.on("table_invite",(function(e){n(e.tableId)})),g.on("win_confirmation_request",t),function(){g.off("state_update",e),g.off("invite:joinTable",n),g.off("win_confirmation_request",t),L.current&&clearInterval(L.current)}}),[]);var F=function(){g.emit("invite:skip",{userId:n._id}),clearInterval(L.current),I(!1),P(null)},Q=function(){var e=(0,s.default)((function*(){try{(yield fetch("/api/auth/logout",{method:"POST",credentials:"include"})).ok&&t(null)}catch(e){console.error("Logout failed:",e)}}));return function(){return e.apply(this,arguments)}}();return r?(0,c.jsx)("div",{children:"Loading..."}):n?(0,c.jsxs)("div",{style:{maxWidth:900,margin:"0 auto",padding:20},children:[(0,c.jsxs)("h2",{children:["Welcome, ",n.displayName||n.username]}),(0,c.jsx)("button",{onClick:Q,style:{marginBottom:20},children:"Logout"}),(0,c.jsxs)("div",{style:{marginBottom:20},children:[(0,c.jsx)("button",{onClick:function(){var e;null!=n&&n._id&&(e=n._id,console.log("joinQueue called with userId:",e),b("join_queue",e))},children:"Join Queue"})," ",n.isAdmin&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("button",{onClick:function(){b("admin:clear_queue")},style:{marginLeft:10},children:"Clear Queue"}),(0,c.jsx)("button",{onClick:function(){b("admin:clear_tables")},style:{marginLeft:10},children:"Clear All Tables"})]})]}),(0,c.jsx)("h3",{children:"Queue:"}),0===a.length?(0,c.jsx)("p",{children:"The queue is currently empty."}):(0,c.jsx)("ol",{children:a.map((function(e,n){var t,l;return(0,c.jsx)("li",{children:(null==(l=e.user)?void 0:l.username)||"Unnamed User"},(null==(t=e.user)?void 0:t._id)||e.userId||n)}))}),(0,c.jsx)("h3",{children:"Tables:"}),(0,c.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:16,marginTop:12},children:v.map((function(e,n){var t,l;return(0,c.jsx)(j,{table:e},null!=(t=null!=(l=e._id)?l:e.tableNumber)?t:n)}))}),q&&(0,c.jsxs)("div",{style:{position:"fixed",top:100,left:"50%",transform:"translateX(-50%)",background:"white",border:"1px solid #ccc",padding:20,zIndex:1e3},children:[(0,c.jsx)("h4",{children:"Your opponent claims they won. Confirm?"}),(0,c.jsx)("button",{onClick:function(){q&&!M&&(z(!0),x(q.tableId,q.winnerId,q.loserId,!0,(function(e){console.log("Confirm win callback:",e),z(!1),null!=e&&e.success&&B(null)})))},disabled:M,style:{marginRight:10},children:M?"Confirming...":"Confirm"}),(0,c.jsx)("button",{onClick:function(){B(null)},children:"Reject"})]}),w&&(0,c.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:9999},children:(0,c.jsxs)("div",{style:{backgroundColor:"white",padding:20,borderRadius:10,textAlign:"center",minWidth:300},children:[(0,c.jsxs)("p",{children:["You have been invited to join table ",S]}),(0,c.jsxs)("p",{children:["Time remaining: ",A," seconds"]}),(0,c.jsx)("button",{onClick:function(){S&&(g.emit("accept_invite",{tableId:S,userId:n._id}),clearInterval(L.current),I(!1),P(null))},children:"Accept Invite"})," ",(0,c.jsx)("button",{onClick:F,children:"Skip"})]})})]}):(0,c.jsx)("div",{children:"Please log in to see your dashboard"})}var y=t(3929),w=t(8514),I=t(9632);function C(){return(0,c.jsx)(y.default,{children:(0,c.jsx)(w.default,{title:"Login with Google",onPress:function(){I.default.openURL("http://localhost:3000/api/auth/google")}})})}var k,S,P=(null==(k=t(5679).default.expoConfig)||null==(S=k.extra)?void 0:S.apiBaseUrl)||"http://localhost:3000";function O(){var e=(0,i.useContext)(d),n=e.user,t=e.setUser,u=(0,i.useState)([]),s=(0,l.default)(u,2),f=s[0],h=s[1],v=(0,i.useState)([]),m=(0,l.default)(v,2),b=m[0],x=m[1],g=(0,i.useState)(null),j=(0,l.default)(g,2),y=j[0],w=j[1],I=(0,i.useState)(!0),k=(0,l.default)(I,2),S=k[0],O=k[1];return(0,i.useEffect)((function(){fetch(`${P}/api/auth/success`,{credentials:"include"}).then((function(e){return e.json()})).then((function(e){e.success?t(e.user):t(null)})).catch((function(e){console.error("Auth check failed:",e),t(null)})).finally((function(){return O(!1)}))}),[t]),(0,i.useEffect)((function(){if(n){var e=(0,p.default)(P,{withCredentials:!0});return w(e),e.on("state_update",(function(e){var n=e.queue,t=e.tables;h(n),x(t)})),e.on("connect_error",(function(e){console.error("Socket connection error:",e)})),function(){e.disconnect()}}}),[n]),S?(0,c.jsx)(a.default,{style:{textAlign:"center",marginTop:50},children:"Loading..."}):n?(0,c.jsx)(r.default,{style:A.container,children:(0,c.jsxs)(o.default,{children:[(0,c.jsx)(a.default,{style:A.title,children:"Pool Hall Waitlist"}),(0,c.jsx)(_,{queue:f,tables:b,socket:y})]})}):(0,c.jsx)(C,{})}function T(){return(0,c.jsx)(f,{children:(0,c.jsx)(O,{})})}var A=u.default.create({container:{flex:1,marginTop:50,paddingHorizontal:16},title:{fontSize:28,fontWeight:"bold",textAlign:"center",marginBottom:24}})}},n={};function t(l){var i=n[l];if(void 0!==i)return i.exports;var r=n[l]={exports:{}};return e[l](r,r.exports,t),r.exports}t.m=e,(()=>{var e=[];t.O=(n,l,i,r)=>{if(!l){var o=1/0;for(c=0;c<e.length;c++){for(var[l,i,r]=e[c],u=!0,a=0;a<l.length;a++)(!1&r||o>=r)&&Object.keys(t.O).every((e=>t.O[e](l[a])))?l.splice(a--,1):(u=!1,r<o&&(o=r));if(u){e.splice(c--,1);var s=i();void 0!==s&&(n=s)}}return n}r=r||0;for(var c=e.length;c>0&&e[c-1][2]>r;c--)e[c]=e[c-1];e[c]=[l,i,r]}})(),t.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},t.d=(e,n)=>{for(var l in n)t.o(n,l)&&!t.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:n[l]})},t.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),t.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={792:0};t.O.j=n=>0===e[n];var n=(n,l)=>{var i,r,[o,u,a]=l,s=0;if(o.some((n=>0!==e[n]))){for(i in u)t.o(u,i)&&(t.m[i]=u[i]);if(a)var c=a(t)}for(n&&n(l);s<o.length;s++)r=o[s],t.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return t.O(c)},l=self.webpackChunkweb=self.webpackChunkweb||[];l.forEach(n.bind(null,0)),l.push=n.bind(null,l.push.bind(l))})();var l=t.O(void 0,[619],(()=>t(5036)));l=t.O(l)})();
//# sourceMappingURL=main.447215de.js.map