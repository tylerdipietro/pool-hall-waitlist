(()=>{"use strict";var e={5918:(e,n,t)=>{t.r(n),t.d(n,{default:()=>N});var l,i,r=t(296),o=t(6665),u=t(4701),a=t(4262),s=t(4890),c=t(6283),d=t(467),f=t(5679),h=t(397),v=(null==(l=f.default.expoConfig)||null==(i=l.extra)?void 0:i.apiBaseUrl)||"http://localhost:3000",x=(0,o.createContext)();function m(e){var n=e.children,t=(0,o.useState)(null),l=(0,r.default)(t,2),i=l[0],u=l[1],a=(0,o.useState)(!0),s=(0,r.default)(a,2),c=s[0],d=s[1];return(0,o.useEffect)((function(){fetch(`${v}/api/auth/success`,{credentials:"include"}).then((function(e){if(200===e.status)return e.json();throw new Error("Not authenticated")})).then((function(e){e.success?u(e.user):u(null)})).catch((function(){return u(null)})).finally((function(){return d(!1)}))}),[]),(0,h.jsx)(x.Provider,{value:{user:i,setUser:u,loading:c},children:n})}var p,g,b,j=t(2038),y=(null==(p=f.default.expoConfig)||null==(g=p.extra)?void 0:g.apiBaseUrl)||"http://localhost:3000";function _(){return b||(b=(0,j.io)(y,{autoConnect:!0})),b}function C(e,n){b||_(),b.emit(e,n)}var I=function(e,n,t,l,i){b.emit("confirm_win",{tableId:e,winnerId:n,loserId:t,confirmed:l},i)};const k=_();function w(e){var n,t,l=e.table,i=(0,o.useContext)(x).user,r=function(){var e,n;null!=i&&i._id&&null!=l&&l._id&&(e=l._id,n=i._id,console.log("[claimWin] Emitting claim_win",{tableId:e,winnerId:n}),C("claim_win",{tableId:e,winnerId:n}))},u=function(e){null!=l&&l._id&&e&&C("admin:remove_player",{tableId:l._id,userId:e})},a=null!=(n=null==l?void 0:l.players)?n:[];return(0,o.useEffect)((function(){null!=i&&i._id&&k.emit("register_user",{userId:i._id})}),[i]),(0,h.jsx)(h.Fragment,{children:(0,h.jsxs)("div",{style:{border:"1px solid #ccc",padding:10,marginBottom:10,borderRadius:5},children:[(0,h.jsxs)("h4",{children:["Table ",null!=(t=null==l?void 0:l.tableNumber)?t:"Unknown"]}),(0,h.jsx)("strong",{children:"Players:"}),(0,h.jsx)("ul",{children:a.map((function(e,n){var t,l=null==e?void 0:e.user,o=null!=(t=null==l?void 0:l._id)?t:n,a=(null==l?void 0:l.displayName)||(null==l?void 0:l.username)||"Unknown Player";return(0,h.jsxs)("li",{style:{marginBottom:6},children:[a,(null==i?void 0:i.isAdmin)&&(null==l?void 0:l._id)&&(0,h.jsx)("button",{onClick:function(){return u(l._id)},style:{marginLeft:10},children:"Remove Player"}),(null==i?void 0:i._id)===(null==l?void 0:l._id)&&(0,h.jsx)("button",{onClick:r,style:{marginLeft:10},children:"I WON"})]},o)}))}),a.length<2&&(0,h.jsx)("button",{onClick:function(){null!=i&&i._id&&null!=l&&l._id&&k.emit("join_table",{tableId:l._id,userId:i._id})},children:"Join Table"})]})})}function S(){var e=(0,o.useContext)(x),n=e.user,t=e.setUser,l=e.loading,i=(0,o.useState)([]),u=(0,r.default)(i,2),a=u[0],s=u[1],c=(0,o.useState)([]),f=(0,r.default)(c,2),v=f[0],m=f[1],p=(0,o.useState)(!1),g=(0,r.default)(p,2),b=g[0],j=g[1],y=(0,o.useState)(null),_=(0,r.default)(y,2),S=_[0],O=_[1],T=(0,o.useState)(30),P=(0,r.default)(T,2),U=P[0],q=P[1],L=(0,o.useRef)(null),B=(0,o.useState)(null),R=(0,r.default)(B,2),A=R[0],E=R[1],W=(0,o.useState)(!1),N=(0,r.default)(W,2),z=N[0],Q=N[1];(0,o.useEffect)((function(){function e(e){var n=e.queue,t=e.tables;console.log("Received state_update with queue:",n,"tables:",t),s(n),m(t)}function n(e){O(e),j(!0),q(30),L.current&&clearInterval(L.current),L.current=setInterval((function(){q((function(e){return e<=1?(clearInterval(L.current),M(),0):e-1}))}),1e3)}function t(e){console.log("Received win confirmation request:",e),E(e)}return k.on("state_update",e),k.on("table_invite",(function(e){n(e.tableId)})),k.on("win_confirmation_request",t),function(){k.off("state_update",e),k.off("invite:joinTable",n),k.off("win_confirmation_request",t),L.current&&clearInterval(L.current)}}),[]);var M=function(){k.emit("invite:skip",{userId:n._id}),clearInterval(L.current),j(!1),O(null)},$=function(){var e=(0,d.default)((function*(){try{(yield fetch("/api/auth/logout",{method:"POST",credentials:"include"})).ok&&t(null)}catch(e){console.error("Logout failed:",e)}}));return function(){return e.apply(this,arguments)}}();return l?(0,h.jsx)("div",{children:"Loading..."}):n?(0,h.jsxs)("div",{style:{maxWidth:900,margin:"0 auto",padding:20},children:[(0,h.jsxs)("h2",{children:["Welcome, ",n.displayName||n.username]}),(0,h.jsx)("button",{onClick:$,style:{marginBottom:20},children:"Logout"}),(0,h.jsxs)("div",{style:{marginBottom:20},children:[(0,h.jsx)("button",{onClick:function(){var e;null!=n&&n._id&&(e=n._id,console.log("joinQueue called with userId:",e),C("join_queue",e))},children:"Join Queue"})," ",n.isAdmin&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("button",{onClick:function(){C("admin:clear_queue")},style:{marginLeft:10},children:"Clear Queue"}),(0,h.jsx)("button",{onClick:function(){C("admin:clear_tables")},style:{marginLeft:10},children:"Clear All Tables"})]})]}),(0,h.jsx)("h3",{children:"Queue:"}),0===a.length?(0,h.jsx)("p",{children:"The queue is currently empty."}):(0,h.jsx)("ol",{children:a.map((function(e,n){var t,l;return(0,h.jsx)("li",{children:(null==(l=e.user)?void 0:l.username)||"Unnamed User"},(null==(t=e.user)?void 0:t._id)||e.userId||n)}))}),(0,h.jsx)("h3",{children:"Tables:"}),(0,h.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:16,marginTop:12},children:v.map((function(e,n){var t,l;return(0,h.jsx)(w,{table:e},null!=(t=null!=(l=e._id)?l:e.tableNumber)?t:n)}))}),A&&(0,h.jsxs)("div",{style:{position:"fixed",top:100,left:"50%",transform:"translateX(-50%)",background:"white",border:"1px solid #ccc",padding:20,zIndex:1e3},children:[(0,h.jsx)("h4",{children:"Your opponent claims they won. Confirm?"}),(0,h.jsx)("button",{onClick:function(){A&&!z&&(Q(!0),I(A.tableId,A.winnerId,A.loserId,!0,(function(e){console.log("Confirm win callback:",e),Q(!1),null!=e&&e.success&&E(null)})))},disabled:z,style:{marginRight:10},children:z?"Confirming...":"Confirm"}),(0,h.jsx)("button",{onClick:function(){E(null)},children:"Reject"})]}),b&&(0,h.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:9999},children:(0,h.jsxs)("div",{style:{backgroundColor:"white",padding:20,borderRadius:10,textAlign:"center",minWidth:300},children:[(0,h.jsxs)("p",{children:["You have been invited to join table ",S]}),(0,h.jsxs)("p",{children:["Time remaining: ",U," seconds"]}),(0,h.jsx)("button",{onClick:function(){S&&(k.emit("accept_invite",{tableId:S,userId:n._id}),clearInterval(L.current),j(!1),O(null))},children:"Accept Invite"})," ",(0,h.jsx)("button",{onClick:M,children:"Skip"})]})})]}):(0,h.jsx)("div",{children:"Please log in to see your dashboard"})}var O,T,P,U,q=t(3929),L=t(8514),B=t(9632),R=(null==(O=f.default.expoConfig)||null==(T=O.extra)?void 0:T.apiBaseUrl)||"http://localhost:3000";function A(){return(0,h.jsx)(q.default,{children:(0,h.jsx)(L.default,{title:"Login with Google",onPress:function(){var e=`${R}/api/auth/google`;B.default.openURL(e)}})})}var E=(null==(P=f.default.expoConfig)||null==(U=P.extra)?void 0:U.apiBaseUrl)||"http://localhost:3000";function W(){var e=(0,o.useContext)(x),n=e.user,t=e.setUser,l=(0,o.useState)([]),i=(0,r.default)(l,2),s=i[0],d=i[1],f=(0,o.useState)([]),v=(0,r.default)(f,2),m=v[0],p=v[1],g=(0,o.useState)(null),b=(0,r.default)(g,2),y=b[0],_=b[1],C=(0,o.useState)(!0),I=(0,r.default)(C,2),k=I[0],w=I[1];return(0,o.useEffect)((function(){fetch(`${E}/api/auth/success`,{credentials:"include"}).then((function(e){return e.json()})).then((function(e){e.success?t(e.user):t(null)})).catch((function(e){console.error("Auth check failed:",e),t(null)})).finally((function(){return w(!1)}))}),[t]),(0,o.useEffect)((function(){if(n){var e=(0,j.default)(E,{withCredentials:!0});return _(e),e.on("state_update",(function(e){var n=e.queue,t=e.tables;d(n),p(t)})),e.on("connect_error",(function(e){console.error("Socket connection error:",e)})),function(){e.disconnect()}}}),[n]),k?(0,h.jsx)(c.default,{style:{textAlign:"center",marginTop:50},children:"Loading..."}):n?(0,h.jsx)(u.default,{style:z.container,children:(0,h.jsxs)(a.default,{children:[(0,h.jsx)(c.default,{style:z.title,children:"Pool Hall Waitlist"}),(0,h.jsx)(S,{queue:s,tables:m,socket:y})]})}):(0,h.jsx)(A,{})}function N(){return(0,h.jsx)(m,{children:(0,h.jsx)(W,{})})}var z=s.default.create({container:{flex:1,marginTop:50,paddingHorizontal:16},title:{fontSize:28,fontWeight:"bold",textAlign:"center",marginBottom:24}})}},n={};function t(l){var i=n[l];if(void 0!==i)return i.exports;var r=n[l]={exports:{}};return e[l](r,r.exports,t),r.exports}t.m=e,(()=>{var e=[];t.O=(n,l,i,r)=>{if(!l){var o=1/0;for(c=0;c<e.length;c++){for(var[l,i,r]=e[c],u=!0,a=0;a<l.length;a++)(!1&r||o>=r)&&Object.keys(t.O).every((e=>t.O[e](l[a])))?l.splice(a--,1):(u=!1,r<o&&(o=r));if(u){e.splice(c--,1);var s=i();void 0!==s&&(n=s)}}return n}r=r||0;for(var c=e.length;c>0&&e[c-1][2]>r;c--)e[c]=e[c-1];e[c]=[l,i,r]}})(),t.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},t.d=(e,n)=>{for(var l in n)t.o(n,l)&&!t.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:n[l]})},t.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),t.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={792:0};t.O.j=n=>0===e[n];var n=(n,l)=>{var i,r,[o,u,a]=l,s=0;if(o.some((n=>0!==e[n]))){for(i in u)t.o(u,i)&&(t.m[i]=u[i]);if(a)var c=a(t)}for(n&&n(l);s<o.length;s++)r=o[s],t.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return t.O(c)},l=self.webpackChunkweb=self.webpackChunkweb||[];l.forEach(n.bind(null,0)),l.push=n.bind(null,l.push.bind(l))})();var l=t.O(void 0,[619],(()=>t(5036)));l=t.O(l)})();
//# sourceMappingURL=main.c873cc1b.js.map