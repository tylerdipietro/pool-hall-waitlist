(()=>{"use strict";var e={5918:(e,n,t)=>{t.r(n),t.d(n,{default:()=>L});var l,i,r=t(296),o=t(6665),u=t(4701),a=t(4262),s=t(4890),c=t(6283),d=t(467),f=t(5679),h=t(397),p=(null==(l=f.default.expoConfig)||null==(i=l.extra)?void 0:i.apiBaseUrl)||"http://localhost:3000",v=(0,o.createContext)();function m(e){var n=e.children,t=(0,o.useState)(null),l=(0,r.default)(t,2),i=l[0],u=l[1],a=(0,o.useState)(!0),s=(0,r.default)(a,2),c=s[0],d=s[1];return(0,o.useEffect)((function(){fetch(`${p}/api/auth/success`,{credentials:"include"}).then((function(e){if(200===e.status)return e.json();throw new Error("Not authenticated")})).then((function(e){e.success?u(e.user):u(null)})).catch((function(){return u(null)})).finally((function(){return d(!1)}))}),[]),(0,h.jsx)(v.Provider,{value:{user:i,setUser:u,loading:c},children:n})}var b,x=t(2038),g={NODE_ENV:"production",PUBLIC_URL:"/pool-hall-waitlist",APP_MANIFEST:{name:"pool-hall-waitlist",slug:"pool-hall-waitlist",version:"1.0.0",sdkVersion:"50.0.0",platforms:["ios","android","web"],extra:{apiBaseUrl:"https://pool-hall-waitlist-3b8c64cbf25d.herokuapp.com"},eas:{projectId:"aa45cd69-a930-432f-a3ab-77a197e338b6"},updates:{url:"https://u.expo.dev/aa45cd69-a930-432f-a3ab-77a197e338b6"},runtimeVersion:{policy:"appVersion"},web:{}},EXPO_DEBUG:!1,PLATFORM:"web",WDS_SOCKET_PATH:"/_expo/ws"}.REACT_APP_API_BASE_URL||"http://localhost:3000";function j(){return b||(b=(0,x.io)(g,{autoConnect:!0})),b}function _(e,n){b||j(),b.emit(e,n)}var y=function(e,n,t,l,i){b.emit("confirm_win",{tableId:e,winnerId:n,loserId:t,confirmed:l},i)};const w=j();function I(e){var n,t,l=e.table,i=(0,o.useContext)(v).user,r=function(){var e,n;null!=i&&i._id&&null!=l&&l._id&&(e=l._id,n=i._id,console.log("[claimWin] Emitting claim_win",{tableId:e,winnerId:n}),_("claim_win",{tableId:e,winnerId:n}))},u=function(e){null!=l&&l._id&&e&&_("admin:remove_player",{tableId:l._id,userId:e})},a=null!=(n=null==l?void 0:l.players)?n:[];return(0,o.useEffect)((function(){null!=i&&i._id&&w.emit("register_user",{userId:i._id})}),[i]),(0,h.jsx)(h.Fragment,{children:(0,h.jsxs)("div",{style:{border:"1px solid #ccc",padding:10,marginBottom:10,borderRadius:5},children:[(0,h.jsxs)("h4",{children:["Table ",null!=(t=null==l?void 0:l.tableNumber)?t:"Unknown"]}),(0,h.jsx)("strong",{children:"Players:"}),(0,h.jsx)("ul",{children:a.map((function(e,n){var t,l=null==e?void 0:e.user,o=null!=(t=null==l?void 0:l._id)?t:n,a=(null==l?void 0:l.displayName)||(null==l?void 0:l.username)||"Unknown Player";return(0,h.jsxs)("li",{style:{marginBottom:6},children:[a,(null==i?void 0:i.isAdmin)&&(null==l?void 0:l._id)&&(0,h.jsx)("button",{onClick:function(){return u(l._id)},style:{marginLeft:10},children:"Remove Player"}),(null==i?void 0:i._id)===(null==l?void 0:l._id)&&(0,h.jsx)("button",{onClick:r,style:{marginLeft:10},children:"I WON"})]},o)}))}),a.length<2&&(0,h.jsx)("button",{onClick:function(){null!=i&&i._id&&null!=l&&l._id&&w.emit("join_table",{tableId:l._id,userId:i._id})},children:"Join Table"})]})})}function C(){var e=(0,o.useContext)(v),n=e.user,t=e.setUser,l=e.loading,i=(0,o.useState)([]),u=(0,r.default)(i,2),a=u[0],s=u[1],c=(0,o.useState)([]),f=(0,r.default)(c,2),p=f[0],m=f[1],b=(0,o.useState)(!1),x=(0,r.default)(b,2),g=x[0],j=x[1],C=(0,o.useState)(null),k=(0,r.default)(C,2),S=k[0],P=k[1],O=(0,o.useState)(30),T=(0,r.default)(O,2),A=T[0],E=T[1],U=(0,o.useRef)(null),L=(0,o.useState)(null),R=(0,r.default)(L,2),B=R[0],q=R[1],N=(0,o.useState)(!1),W=(0,r.default)(N,2),M=W[0],z=W[1];(0,o.useEffect)((function(){function e(e){var n=e.queue,t=e.tables;console.log("Received state_update with queue:",n,"tables:",t),s(n),m(t)}function n(e){P(e),j(!0),E(30),U.current&&clearInterval(U.current),U.current=setInterval((function(){E((function(e){return e<=1?(clearInterval(U.current),F(),0):e-1}))}),1e3)}function t(e){console.log("Received win confirmation request:",e),q(e)}return w.on("state_update",e),w.on("table_invite",(function(e){n(e.tableId)})),w.on("win_confirmation_request",t),function(){w.off("state_update",e),w.off("invite:joinTable",n),w.off("win_confirmation_request",t),U.current&&clearInterval(U.current)}}),[]);var F=function(){w.emit("invite:skip",{userId:n._id}),clearInterval(U.current),j(!1),P(null)},Q=function(){var e=(0,d.default)((function*(){try{(yield fetch("/api/auth/logout",{method:"POST",credentials:"include"})).ok&&t(null)}catch(e){console.error("Logout failed:",e)}}));return function(){return e.apply(this,arguments)}}();return l?(0,h.jsx)("div",{children:"Loading..."}):n?(0,h.jsxs)("div",{style:{maxWidth:900,margin:"0 auto",padding:20},children:[(0,h.jsxs)("h2",{children:["Welcome, ",n.displayName||n.username]}),(0,h.jsx)("button",{onClick:Q,style:{marginBottom:20},children:"Logout"}),(0,h.jsxs)("div",{style:{marginBottom:20},children:[(0,h.jsx)("button",{onClick:function(){var e;null!=n&&n._id&&(e=n._id,console.log("joinQueue called with userId:",e),_("join_queue",e))},children:"Join Queue"})," ",n.isAdmin&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("button",{onClick:function(){_("admin:clear_queue")},style:{marginLeft:10},children:"Clear Queue"}),(0,h.jsx)("button",{onClick:function(){_("admin:clear_tables")},style:{marginLeft:10},children:"Clear All Tables"})]})]}),(0,h.jsx)("h3",{children:"Queue:"}),0===a.length?(0,h.jsx)("p",{children:"The queue is currently empty."}):(0,h.jsx)("ol",{children:a.map((function(e,n){var t,l;return(0,h.jsx)("li",{children:(null==(l=e.user)?void 0:l.username)||"Unnamed User"},(null==(t=e.user)?void 0:t._id)||e.userId||n)}))}),(0,h.jsx)("h3",{children:"Tables:"}),(0,h.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:16,marginTop:12},children:p.map((function(e,n){var t,l;return(0,h.jsx)(I,{table:e},null!=(t=null!=(l=e._id)?l:e.tableNumber)?t:n)}))}),B&&(0,h.jsxs)("div",{style:{position:"fixed",top:100,left:"50%",transform:"translateX(-50%)",background:"white",border:"1px solid #ccc",padding:20,zIndex:1e3},children:[(0,h.jsx)("h4",{children:"Your opponent claims they won. Confirm?"}),(0,h.jsx)("button",{onClick:function(){B&&!M&&(z(!0),y(B.tableId,B.winnerId,B.loserId,!0,(function(e){console.log("Confirm win callback:",e),z(!1),null!=e&&e.success&&q(null)})))},disabled:M,style:{marginRight:10},children:M?"Confirming...":"Confirm"}),(0,h.jsx)("button",{onClick:function(){q(null)},children:"Reject"})]}),g&&(0,h.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:9999},children:(0,h.jsxs)("div",{style:{backgroundColor:"white",padding:20,borderRadius:10,textAlign:"center",minWidth:300},children:[(0,h.jsxs)("p",{children:["You have been invited to join table ",S]}),(0,h.jsxs)("p",{children:["Time remaining: ",A," seconds"]}),(0,h.jsx)("button",{onClick:function(){S&&(w.emit("accept_invite",{tableId:S,userId:n._id}),clearInterval(U.current),j(!1),P(null))},children:"Accept Invite"})," ",(0,h.jsx)("button",{onClick:F,children:"Skip"})]})})]}):(0,h.jsx)("div",{children:"Please log in to see your dashboard"})}var k,S,P=t(3929),O=t(8514),T=t(9632);function A(){return(0,h.jsx)(P.default,{children:(0,h.jsx)(O.default,{title:"Login with Google",onPress:function(){T.default.openURL("http://localhost:3000/api/auth/google")}})})}var E=(null==(k=f.default.expoConfig)||null==(S=k.extra)?void 0:S.apiBaseUrl)||"http://localhost:3000";function U(){var e=(0,o.useContext)(v),n=e.user,t=e.setUser,l=(0,o.useState)([]),i=(0,r.default)(l,2),s=i[0],d=i[1],f=(0,o.useState)([]),p=(0,r.default)(f,2),m=p[0],b=p[1],g=(0,o.useState)(null),j=(0,r.default)(g,2),_=j[0],y=j[1],w=(0,o.useState)(!0),I=(0,r.default)(w,2),k=I[0],S=I[1];return(0,o.useEffect)((function(){fetch(`${E}/api/auth/success`,{credentials:"include"}).then((function(e){return e.json()})).then((function(e){e.success?t(e.user):t(null)})).catch((function(e){console.error("Auth check failed:",e),t(null)})).finally((function(){return S(!1)}))}),[t]),(0,o.useEffect)((function(){if(n){var e=(0,x.default)(E,{withCredentials:!0});return y(e),e.on("state_update",(function(e){var n=e.queue,t=e.tables;d(n),b(t)})),e.on("connect_error",(function(e){console.error("Socket connection error:",e)})),function(){e.disconnect()}}}),[n]),k?(0,h.jsx)(c.default,{style:{textAlign:"center",marginTop:50},children:"Loading..."}):n?(0,h.jsx)(u.default,{style:R.container,children:(0,h.jsxs)(a.default,{children:[(0,h.jsx)(c.default,{style:R.title,children:"Pool Hall Waitlist"}),(0,h.jsx)(C,{queue:s,tables:m,socket:_})]})}):(0,h.jsx)(A,{})}function L(){return(0,h.jsx)(m,{children:(0,h.jsx)(U,{})})}var R=s.default.create({container:{flex:1,marginTop:50,paddingHorizontal:16},title:{fontSize:28,fontWeight:"bold",textAlign:"center",marginBottom:24}})}},n={};function t(l){var i=n[l];if(void 0!==i)return i.exports;var r=n[l]={exports:{}};return e[l](r,r.exports,t),r.exports}t.m=e,(()=>{var e=[];t.O=(n,l,i,r)=>{if(!l){var o=1/0;for(c=0;c<e.length;c++){for(var[l,i,r]=e[c],u=!0,a=0;a<l.length;a++)(!1&r||o>=r)&&Object.keys(t.O).every((e=>t.O[e](l[a])))?l.splice(a--,1):(u=!1,r<o&&(o=r));if(u){e.splice(c--,1);var s=i();void 0!==s&&(n=s)}}return n}r=r||0;for(var c=e.length;c>0&&e[c-1][2]>r;c--)e[c]=e[c-1];e[c]=[l,i,r]}})(),t.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},t.d=(e,n)=>{for(var l in n)t.o(n,l)&&!t.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:n[l]})},t.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),t.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={792:0};t.O.j=n=>0===e[n];var n=(n,l)=>{var i,r,[o,u,a]=l,s=0;if(o.some((n=>0!==e[n]))){for(i in u)t.o(u,i)&&(t.m[i]=u[i]);if(a)var c=a(t)}for(n&&n(l);s<o.length;s++)r=o[s],t.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return t.O(c)},l=self.webpackChunkweb=self.webpackChunkweb||[];l.forEach(n.bind(null,0)),l.push=n.bind(null,l.push.bind(l))})();var l=t.O(void 0,[619],(()=>t(5036)));l=t.O(l)})();
//# sourceMappingURL=main.d494cec3.js.map