{"ast":null,"code":"import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";var _Constants$expoConfig,_Constants$expoConfig2;import React,{useState,useEffect,useContext}from'react';import SafeAreaView from\"react-native-web/dist/exports/SafeAreaView\";import ScrollView from\"react-native-web/dist/exports/ScrollView\";import StyleSheet from\"react-native-web/dist/exports/StyleSheet\";import Text from\"react-native-web/dist/exports/Text\";import Platform from\"react-native-web/dist/exports/Platform\";import Dashboard from'./components/Dashboard';import LoginScreen from'./components/LoginScreen';import{AuthProvider,AuthContext}from'./contexts/AuthContext';import io from'socket.io-client';import Constants from'expo-constants';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";var API_BASE_URL=((_Constants$expoConfig=Constants.expoConfig)==null?void 0:(_Constants$expoConfig2=_Constants$expoConfig.extra)==null?void 0:_Constants$expoConfig2.apiBaseUrl)||'http://localhost:3000';function AppInner(){var _useContext=useContext(AuthContext),user=_useContext.user,setUser=_useContext.setUser;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),queue=_useState2[0],setQueue=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),tables=_useState4[0],setTables=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),socket=_useState6[0],setSocket=_useState6[1];var _useState7=useState(true),_useState8=_slicedToArray(_useState7,2),loading=_useState8[0],setLoading=_useState8[1];useEffect(function(){fetch(`${API_BASE_URL}/api/auth/success`,{credentials:'include'}).then(function(res){return res.json();}).then(function(data){if(data.success){setUser(data.user);}else{setUser(null);}}).catch(function(err){console.error('Auth check failed:',err);setUser(null);}).finally(function(){return setLoading(false);});},[setUser]);useEffect(function(){if(!user)return;var socketClient=io(API_BASE_URL,{withCredentials:true});setSocket(socketClient);socketClient.on('state_update',function(_ref){var queue=_ref.queue,tables=_ref.tables;setQueue(queue);setTables(tables);});socketClient.on('connect_error',function(err){console.error('Socket connection error:',err);});return function(){socketClient.disconnect();};},[user]);if(loading){return _jsx(Text,{style:{textAlign:'center',marginTop:50},children:\"Loading...\"});}if(!user){return _jsx(LoginScreen,{});}return _jsx(SafeAreaView,{style:styles.container,children:_jsxs(ScrollView,{children:[_jsx(Text,{style:styles.title,children:\"Pool Hall Waitlist\"}),_jsx(Dashboard,{queue:queue,tables:tables,socket:socket})]})});}export default function App(){return _jsx(AuthProvider,{children:_jsx(AppInner,{})});}var styles=StyleSheet.create({container:{flex:1,marginTop:50,paddingHorizontal:16},title:{fontSize:28,fontWeight:'bold',textAlign:'center',marginBottom:24}});","map":{"version":3,"names":["React","useState","useEffect","useContext","SafeAreaView","ScrollView","StyleSheet","Text","Platform","Dashboard","LoginScreen","AuthProvider","AuthContext","io","Constants","jsx","_jsx","jsxs","_jsxs","API_BASE_URL","_Constants$expoConfig","expoConfig","_Constants$expoConfig2","extra","apiBaseUrl","AppInner","_useContext","user","setUser","_useState","_useState2","_slicedToArray","queue","setQueue","_useState3","_useState4","tables","setTables","_useState5","_useState6","socket","setSocket","_useState7","_useState8","loading","setLoading","fetch","credentials","then","res","json","data","success","catch","err","console","error","finally","socketClient","withCredentials","on","_ref","disconnect","style","textAlign","marginTop","children","styles","container","title","App","create","flex","paddingHorizontal","fontSize","fontWeight","marginBottom"],"sources":["D:/pool-hall-waitlist/frontend/App.js"],"sourcesContent":["import React, { useState, useEffect, useContext } from 'react';\r\nimport { SafeAreaView, ScrollView, StyleSheet, Text, Platform } from 'react-native';\r\nimport Dashboard from './components/Dashboard';\r\nimport LoginScreen from './components/LoginScreen';\r\nimport { AuthProvider, AuthContext } from './contexts/AuthContext';\r\nimport io from 'socket.io-client';\r\nimport Constants from 'expo-constants';\r\n\r\nconst API_BASE_URL = Constants.expoConfig?.extra?.apiBaseUrl || 'http://localhost:3000';\r\n\r\nfunction AppInner() {\r\n  const { user, setUser } = useContext(AuthContext);\r\n  const [queue, setQueue] = useState([]);\r\n  const [tables, setTables] = useState([]);\r\n  const [socket, setSocket] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  // On app load, check if user session exists\r\n  useEffect(() => {\r\n    fetch(`${API_BASE_URL}/api/auth/success`, {\r\n      credentials: 'include',  // Important to send cookies\r\n    })\r\n      .then(res => res.json())\r\n      .then(data => {\r\n        if (data.success) {\r\n          setUser(data.user);\r\n        } else {\r\n          setUser(null);\r\n        }\r\n      })\r\n      .catch(err => {\r\n        console.error('Auth check failed:', err);\r\n        setUser(null);\r\n      })\r\n      .finally(() => setLoading(false));\r\n  }, [setUser]);\r\n\r\n  // Setup socket only if user is logged in\r\n  useEffect(() => {\r\n    if (!user) return;\r\n\r\n    const socketClient = io(API_BASE_URL, {\r\n      withCredentials: true,  // allow cookies\r\n      // don't send token since you use cookie sessions\r\n    });\r\n\r\n    setSocket(socketClient);\r\n\r\n    socketClient.on('state_update', ({ queue, tables }) => {\r\n      setQueue(queue);\r\n      setTables(tables);\r\n    });\r\n\r\n    socketClient.on('connect_error', (err) => {\r\n      console.error('Socket connection error:', err);\r\n    });\r\n\r\n    return () => {\r\n      socketClient.disconnect();\r\n    };\r\n  }, [user]);\r\n\r\n  if (loading) {\r\n    return <Text style={{ textAlign: 'center', marginTop: 50 }}>Loading...</Text>;\r\n  }\r\n\r\n  if (!user) {\r\n    // Not logged in, show LoginScreen\r\n    return <LoginScreen />;\r\n  }\r\n\r\n  return (\r\n    <SafeAreaView style={styles.container}>\r\n      <ScrollView>\r\n        <Text style={styles.title}>Pool Hall Waitlist</Text>\r\n        <Dashboard queue={queue} tables={tables} socket={socket} />\r\n      </ScrollView>\r\n    </SafeAreaView>\r\n  );\r\n}\r\n\r\nexport default function App() {\r\n  return (\r\n    <AuthProvider>\r\n      <AppInner />\r\n    </AuthProvider>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: { flex: 1, marginTop: 50, paddingHorizontal: 16 },\r\n  title: { fontSize: 28, fontWeight: 'bold', textAlign: 'center', marginBottom: 24 },\r\n});\r\n"],"mappings":"kHAAA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,CAAEC,SAAS,CAAEC,UAAU,KAAQ,OAAO,CAAC,OAAAC,YAAA,yDAAAC,UAAA,uDAAAC,UAAA,uDAAAC,IAAA,iDAAAC,QAAA,8CAE/D,MAAO,CAAAC,SAAS,KAAM,wBAAwB,CAC9C,MAAO,CAAAC,WAAW,KAAM,0BAA0B,CAClD,OAASC,YAAY,CAAEC,WAAW,KAAQ,wBAAwB,CAClE,MAAO,CAAAC,EAAE,KAAM,kBAAkB,CACjC,MAAO,CAAAC,SAAS,KAAM,gBAAgB,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAEvC,GAAM,CAAAC,YAAY,CAAG,EAAAC,qBAAA,CAAAN,SAAS,CAACO,UAAU,gBAAAC,sBAAA,CAApBF,qBAAA,CAAsBG,KAAK,eAA3BD,sBAAA,CAA6BE,UAAU,GAAI,uBAAuB,CAEvF,QAAS,CAAAC,QAAQA,CAAA,CAAG,CAClB,IAAAC,WAAA,CAA0BvB,UAAU,CAACS,WAAW,CAAC,CAAzCe,IAAI,CAAAD,WAAA,CAAJC,IAAI,CAAEC,OAAO,CAAAF,WAAA,CAAPE,OAAO,CACrB,IAAAC,SAAA,CAA0B5B,QAAQ,CAAC,EAAE,CAAC,CAAA6B,UAAA,CAAAC,cAAA,CAAAF,SAAA,IAA/BG,KAAK,CAAAF,UAAA,IAAEG,QAAQ,CAAAH,UAAA,IACtB,IAAAI,UAAA,CAA4BjC,QAAQ,CAAC,EAAE,CAAC,CAAAkC,UAAA,CAAAJ,cAAA,CAAAG,UAAA,IAAjCE,MAAM,CAAAD,UAAA,IAAEE,SAAS,CAAAF,UAAA,IACxB,IAAAG,UAAA,CAA4BrC,QAAQ,CAAC,IAAI,CAAC,CAAAsC,UAAA,CAAAR,cAAA,CAAAO,UAAA,IAAnCE,MAAM,CAAAD,UAAA,IAAEE,SAAS,CAAAF,UAAA,IACxB,IAAAG,UAAA,CAA8BzC,QAAQ,CAAC,IAAI,CAAC,CAAA0C,UAAA,CAAAZ,cAAA,CAAAW,UAAA,IAArCE,OAAO,CAAAD,UAAA,IAAEE,UAAU,CAAAF,UAAA,IAG1BzC,SAAS,CAAC,UAAM,CACd4C,KAAK,CAAC,GAAG3B,YAAY,mBAAmB,CAAE,CACxC4B,WAAW,CAAE,SACf,CAAC,CAAC,CACCC,IAAI,CAAC,SAAAC,GAAG,QAAI,CAAAA,GAAG,CAACC,IAAI,CAAC,CAAC,GAAC,CACvBF,IAAI,CAAC,SAAAG,IAAI,CAAI,CACZ,GAAIA,IAAI,CAACC,OAAO,CAAE,CAChBxB,OAAO,CAACuB,IAAI,CAACxB,IAAI,CAAC,CACpB,CAAC,IAAM,CACLC,OAAO,CAAC,IAAI,CAAC,CACf,CACF,CAAC,CAAC,CACDyB,KAAK,CAAC,SAAAC,GAAG,CAAI,CACZC,OAAO,CAACC,KAAK,CAAC,oBAAoB,CAAEF,GAAG,CAAC,CACxC1B,OAAO,CAAC,IAAI,CAAC,CACf,CAAC,CAAC,CACD6B,OAAO,CAAC,iBAAM,CAAAZ,UAAU,CAAC,KAAK,CAAC,GAAC,CACrC,CAAC,CAAE,CAACjB,OAAO,CAAC,CAAC,CAGb1B,SAAS,CAAC,UAAM,CACd,GAAI,CAACyB,IAAI,CAAE,OAEX,GAAM,CAAA+B,YAAY,CAAG7C,EAAE,CAACM,YAAY,CAAE,CACpCwC,eAAe,CAAE,IAEnB,CAAC,CAAC,CAEFlB,SAAS,CAACiB,YAAY,CAAC,CAEvBA,YAAY,CAACE,EAAE,CAAC,cAAc,CAAE,SAAAC,IAAA,CAAuB,IAApB,CAAA7B,KAAK,CAAA6B,IAAA,CAAL7B,KAAK,CAAEI,MAAM,CAAAyB,IAAA,CAANzB,MAAM,CAC9CH,QAAQ,CAACD,KAAK,CAAC,CACfK,SAAS,CAACD,MAAM,CAAC,CACnB,CAAC,CAAC,CAEFsB,YAAY,CAACE,EAAE,CAAC,eAAe,CAAE,SAACN,GAAG,CAAK,CACxCC,OAAO,CAACC,KAAK,CAAC,0BAA0B,CAAEF,GAAG,CAAC,CAChD,CAAC,CAAC,CAEF,MAAO,WAAM,CACXI,YAAY,CAACI,UAAU,CAAC,CAAC,CAC3B,CAAC,CACH,CAAC,CAAE,CAACnC,IAAI,CAAC,CAAC,CAEV,GAAIiB,OAAO,CAAE,CACX,MAAO,CAAA5B,IAAA,CAACT,IAAI,EAACwD,KAAK,CAAE,CAAEC,SAAS,CAAE,QAAQ,CAAEC,SAAS,CAAE,EAAG,CAAE,CAAAC,QAAA,CAAC,YAAU,CAAM,CAAC,CAC/E,CAEA,GAAI,CAACvC,IAAI,CAAE,CAET,MAAO,CAAAX,IAAA,CAACN,WAAW,GAAE,CAAC,CACxB,CAEA,MACE,CAAAM,IAAA,CAACZ,YAAY,EAAC2D,KAAK,CAAEI,MAAM,CAACC,SAAU,CAAAF,QAAA,CACpChD,KAAA,CAACb,UAAU,EAAA6D,QAAA,EACTlD,IAAA,CAACT,IAAI,EAACwD,KAAK,CAAEI,MAAM,CAACE,KAAM,CAAAH,QAAA,CAAC,oBAAkB,CAAM,CAAC,CACpDlD,IAAA,CAACP,SAAS,EAACuB,KAAK,CAAEA,KAAM,CAACI,MAAM,CAAEA,MAAO,CAACI,MAAM,CAAEA,MAAO,CAAE,CAAC,EACjD,CAAC,CACD,CAAC,CAEnB,CAEA,cAAe,SAAS,CAAA8B,GAAGA,CAAA,CAAG,CAC5B,MACE,CAAAtD,IAAA,CAACL,YAAY,EAAAuD,QAAA,CACXlD,IAAA,CAACS,QAAQ,GAAE,CAAC,CACA,CAAC,CAEnB,CAEA,GAAM,CAAA0C,MAAM,CAAG7D,UAAU,CAACiE,MAAM,CAAC,CAC/BH,SAAS,CAAE,CAAEI,IAAI,CAAE,CAAC,CAAEP,SAAS,CAAE,EAAE,CAAEQ,iBAAiB,CAAE,EAAG,CAAC,CAC5DJ,KAAK,CAAE,CAAEK,QAAQ,CAAE,EAAE,CAAEC,UAAU,CAAE,MAAM,CAAEX,SAAS,CAAE,QAAQ,CAAEY,YAAY,CAAE,EAAG,CACnF,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}